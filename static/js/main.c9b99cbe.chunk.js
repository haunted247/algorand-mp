(this["webpackJsonpalgorand-marketplace"]=this["webpackJsonpalgorand-marketplace"]||[]).push([[0],{13:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o})),n.d(t,"e",(function(){return r})),n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d}));var a=n(7),c=n(39),s=n.n(c);const o=t=>e.from(t,"base64").toString("utf-8"),r=t=>e.from(t,"utf8").toString("base64"),i=e=>{if(e)return e.slice(0,5)+"..."+e.slice(e.length-5,e.length)},l=e=>{if(!e)return;return new s.a(e).shiftedBy(-a.a).toFixed(3)},d=e=>{if(!e)return;return new s.a(e).shiftedBy(a.a).toNumber()}}).call(this,n(2).Buffer)},43:function(e,t,n){"use strict";(function(e,a){n.d(t,"b",(function(){return b})),n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return j})),n.d(t,"d",(function(){return p}));var c=n(9),s=n(7),o=n(64),r=n(65),i=n(13);e.Buffer=e.Buffer||n(2).Buffer;class l{constructor(e,t,n,a,c,s,o){this.name=e,this.image=t,this.description=n,this.price=a,this.sold=c,this.appId=s,this.owner=o}}const d=async e=>{let t=(new TextEncoder).encode(e),n=await s.b.compile(t).do();return new Uint8Array(a.from(n.result,"base64"))},b=async(e,t)=>{var n;if(console.log("Adding product..."),(null===(n=t.image)||void 0===n?void 0:n.length)>30)throw new Error("Image text is too long. Try a shorter url");let a=await s.b.getTransactionParams().do();a.fee=c.a.ALGORAND_MIN_TX_FEE,a.flatFee=!0;const i=await d(o.a),l=await d(r.a);let b=(new TextEncoder).encode(s.d),u=[(new TextEncoder).encode(t.name),(new TextEncoder).encode(t.image),(new TextEncoder).encode(t.description),c.a.encodeUint64(t.price)],j=c.a.makeApplicationCreateTxnFromObject({from:e,suggestedParams:a,onComplete:c.a.OnApplicationComplete.NoOpOC,approvalProgram:i,clearProgram:l,numLocalInts:s.j,numLocalByteSlices:s.i,numGlobalInts:s.h,numGlobalByteSlices:s.g,note:b,appArgs:u}),p=j.txID().toString(),m=await s.f.signTransaction(j.toByte());console.log("Signed transaction with txID: %s",p),await s.b.sendRawTransaction(m.blob).do();let x=await c.a.waitForConfirmation(s.b,p,4);console.log("Transaction "+p+" confirmed in round "+x["confirmed-round"]);let g=(await s.b.pendingTransactionInformation(p).do())["application-index"];return console.log("Created new app-id: ",g),g},u=async(e,t,n)=>{console.log("Buying product...");let a=await s.b.getTransactionParams().do();a.fee=c.a.ALGORAND_MIN_TX_FEE,a.flatFee=!0;let o=[(new TextEncoder).encode("buy"),c.a.encodeUint64(n)],r=[c.a.makeApplicationCallTxnFromObject({from:e,appIndex:t.appId,onComplete:c.a.OnApplicationComplete.NoOpOC,suggestedParams:a,appArgs:o}),c.a.makePaymentTxnWithSuggestedParamsFromObject({from:e,to:t.owner,amount:t.price*n,suggestedParams:a})],i=c.a.computeGroupID(r);for(let c=0;c<2;c++)r[c].group=i;let l=await s.f.signTransaction(r.map((e=>e.toByte())));console.log("Signed group transaction");let d=await s.b.sendRawTransaction(l.map((e=>e.blob))).do(),b=await c.a.waitForConfirmation(s.b,d.txId,4);console.log("Group transaction "+d.txId+" confirmed in round "+b["confirmed-round"])},j=async(e,t)=>{console.log("Deleting application...");let n=await s.b.getTransactionParams().do();n.fee=c.a.ALGORAND_MIN_TX_FEE,n.flatFee=!0;let a=c.a.makeApplicationDeleteTxnFromObject({from:e,suggestedParams:n,appIndex:t}),o=a.txID().toString(),r=await s.f.signTransaction(a.toByte());console.log("Signed transaction with txID: %s",o),await s.b.sendRawTransaction(r.blob).do();const i=await c.a.waitForConfirmation(s.b,o,4);console.log("Transaction "+o+" confirmed in round "+i["confirmed-round"]);let l=(await s.b.pendingTransactionInformation(o).do()).txn.txn.apid;console.log("Deleted app-id: ",l)},p=async()=>{console.log("Fetching products...");let e=(new TextEncoder).encode(s.d),t=a.from(e).toString("base64"),n=await s.c.searchForTransactions().notePrefix(t).txType("appl").minRound(s.e).do(),c=[];for(const a of n.transactions){let e=a["created-application-index"];if(e){let t=await m(e);t&&c.push(t)}}return console.log("Products fetched."),c},m=async e=>{try{let t=await s.c.lookupApplications(e).includeAll(!0).do();if(t.application.deleted)return null;let n=t.application.params["global-state"],a=t.application.params.creator,c="",o="",r="",d=0,b=0;const u=(e,t)=>t.find((t=>t.key===Object(i.e)(e)));if(void 0!==u("NAME",n)){let e=u("NAME",n).value.bytes;c=Object(i.a)(e)}if(void 0!==u("IMAGE",n)){let e=u("IMAGE",n).value.bytes;o=Object(i.a)(e)}if(void 0!==u("DESCRIPTION",n)){let e=u("DESCRIPTION",n).value.bytes;r=Object(i.a)(e)}return void 0!==u("PRICE",n)&&(d=u("PRICE",n).value.uint),void 0!==u("SOLD",n)&&(b=u("SOLD",n).value.uint),new l(c,o,r,d,b,e,a)}catch(t){return null}}}).call(this,n(37),n(2).Buffer)},64:function(e,t,n){"use strict";t.a='#pragma version 6\ntxn ApplicationID\nint 0\n==\nbnz main_l8\ntxn OnCompletion\nint DeleteApplication\n==\nbnz main_l7\ntxna ApplicationArgs 0\nbyte "buy"\n==\nbnz main_l4\nerr\nmain_l4:\nglobal GroupSize\nint 2\n==\ngtxn 1 TypeEnum\nint pay\n==\ngtxn 1 Receiver\nglobal CreatorAddress\n==\n&&\ngtxn 1 Amount\nbyte "PRICE"\napp_global_get\ntxna ApplicationArgs 1\nbtoi\n*\n==\n&&\ngtxn 1 Sender\ngtxn 0 Sender\n==\n&&\n&&\nbnz main_l6\nint 0\nreturn\nmain_l6:\nbyte "SOLD"\nbyte "SOLD"\napp_global_get\ntxna ApplicationArgs 1\nbtoi\n+\napp_global_put\nint 1\nreturn\nmain_l7:\ntxn Sender\nglobal CreatorAddress\n==\nreturn\nmain_l8:\ntxn NumAppArgs\nint 4\n==\nassert\ntxn Note\nbyte "tutorial-marketplace:uv1"\n==\nassert\ntxna ApplicationArgs 3\nbtoi\nint 0\n>\nassert\nbyte "NAME"\ntxna ApplicationArgs 0\napp_global_put\nbyte "IMAGE"\ntxna ApplicationArgs 1\napp_global_put\nbyte "DESCRIPTION"\ntxna ApplicationArgs 2\napp_global_put\nbyte "PRICE"\ntxna ApplicationArgs 3\nbtoi\napp_global_put\nbyte "SOLD"\nint 0\napp_global_put\nint 1\nreturn'},65:function(e,t,n){"use strict";t.a="#pragma version 6\nint 1\nreturn"},7:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return j})),n.d(t,"f",(function(){return p})),n.d(t,"e",(function(){return m})),n.d(t,"d",(function(){return x})),n.d(t,"j",(function(){return g})),n.d(t,"i",(function(){return O})),n.d(t,"h",(function(){return h})),n.d(t,"g",(function(){return f})),n.d(t,"a",(function(){return y}));var a=n(9),c=n(61),s=n.n(c);const o="",r="https://testnet-api.algonode.network",i="",l="",d="https://testnet-idx.algonode.network",b="",u=new a.a.Algodv2(o,r,i),j=new a.a.Indexer(l,d,b),p=new s.a({timeout:1e8}),m=29556983,x="tutorial-marketplace:uv1",g=0,O=0,h=2,f=3,y=6},72:function(e,t,n){},76:function(e,t){},92:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),s=n(17),o=n.n(s),r=n(58),i=n(1);var l=e=>{let{name:t,coverImg:n,connect:a}=e;return Object(i.jsxs)("div",{className:"d-flex justify-content-center flex-column text-center bg-black min-vh-100",children:[Object(i.jsxs)("div",{className:"mt-auto text-light mb-5",children:[Object(i.jsx)("div",{className:" ratio ratio-1x1 mx-auto mb-2",style:{maxWidth:"320px"},children:Object(i.jsx)("img",{src:n,alt:""})}),Object(i.jsx)("h1",{children:t}),Object(i.jsx)("p",{children:"Please connect your wallet to continue."}),Object(i.jsx)(r.a,{onClick:()=>a(),variant:"outline-light",className:"rounded-pill px-3 mt-3",children:"Connect Wallet"})]}),Object(i.jsx)("p",{className:"mt-auto text-secondary",children:"Powered by Algorand"})]})},d=(n(72),n(100)),b=n(96),u=n(105),j=n(13),p=n(55),m=n.n(p),x=n(8),g=n.n(x);m.a.propTypes={size:g.a.number.isRequired,address:g.a.string.isRequired};var O=e=>{let{size:t,address:n,...a}=e;return Object(i.jsx)("div",{...a,style:{width:"".concat(t,"px"),height:"".concat(t,"px")},children:Object(i.jsx)(m.a,{string:n,size:30})})};var h=e=>{let{address:t,name:n,amount:a,symbol:c,disconnect:s}=e;return t?Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)(d.a,{children:[Object(i.jsxs)(d.a.Toggle,{variant:"light",align:"end",id:"dropdown-basic",className:"d-flex align-items-center border rounded-pill py-1",children:[a?Object(i.jsxs)(i.Fragment,{children:[Object(j.b)(a),Object(i.jsxs)("span",{className:"ms-1",children:[" ",c]})]}):Object(i.jsx)(b.a,{animation:"border",size:"sm",className:"opacity-25"}),Object(i.jsx)(O,{address:t,size:28,className:"ms-2 me-1"})]}),Object(i.jsxs)(d.a.Menu,{className:"shadow-lg border-0",children:[Object(i.jsx)(d.a.Item,{href:"https://testnet.algoexplorer.io/address/".concat(t),target:"_blank",children:Object(i.jsxs)(u.a,{direction:"horizontal",gap:2,children:[Object(i.jsx)("i",{className:"bi bi-person-circle fs-4"}),Object(i.jsxs)("div",{className:"d-flex flex-column",children:[n&&Object(i.jsx)("span",{className:"font-monospace",children:n}),Object(i.jsx)("span",{className:"font-monospace",children:Object(j.d)(t)})]})]})}),Object(i.jsx)(d.a.Divider,{}),Object(i.jsxs)(d.a.Item,{as:"button",className:"d-flex align-items-center",onClick:()=>{s()},children:[Object(i.jsx)("i",{className:"bi bi-box-arrow-right me-2 fs-4"}),"Disconnect"]})]})]})}):null},f=n(99),y=n(104),w=n(22),v=n(101),N=n(102),A=n(63);var I=e=>{let{createProduct:t}=e;const[n,c]=Object(a.useState)(""),[s,o]=Object(a.useState)(""),[l,d]=Object(a.useState)(""),[b,u]=Object(a.useState)(0),p=Object(a.useCallback)((()=>n&&s&&l&&b>0),[n,s,l,b]),[m,x]=Object(a.useState)(!1),g=()=>x(!1);return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(r.a,{onClick:()=>x(!0),variant:"dark",className:"rounded-pill px-0",style:{width:"38px"},children:Object(i.jsx)("i",{className:"bi bi-plus"})}),Object(i.jsxs)(v.a,{show:m,onHide:g,centered:!0,children:[Object(i.jsx)(v.a.Header,{closeButton:!0,children:Object(i.jsx)(v.a.Title,{children:"New Product"})}),Object(i.jsx)(N.a,{children:Object(i.jsxs)(v.a.Body,{children:[Object(i.jsx)(A.a,{controlId:"inputName",label:"Product name",className:"mb-3",children:Object(i.jsx)(N.a.Control,{type:"text",onChange:e=>{c(e.target.value)},placeholder:"Enter name of product"})}),Object(i.jsx)(A.a,{controlId:"inputUrl",label:"Image URL",className:"mb-3",children:Object(i.jsx)(N.a.Control,{type:"text",placeholder:"Image URL",value:s,onChange:e=>{o(e.target.value)}})}),Object(i.jsx)(A.a,{controlId:"inputDescription",label:"Description",className:"mb-3",children:Object(i.jsx)(N.a.Control,{as:"textarea",placeholder:"description",style:{height:"80px"},onChange:e=>{d(e.target.value)}})}),Object(i.jsx)(A.a,{controlId:"inputPrice",label:"Price in ALGO",className:"mb-3",children:Object(i.jsx)(N.a.Control,{type:"text",placeholder:"Price",onChange:e=>{u(Object(j.c)(e.target.value))}})})]})}),Object(i.jsxs)(v.a.Footer,{children:[Object(i.jsx)(r.a,{variant:"outline-secondary",onClick:g,children:"Close"}),Object(i.jsx)(r.a,{variant:"dark",disabled:!p(),onClick:()=>{t({name:n,image:s,description:l,price:b}),g()},children:"Save product"})]})]})]})},C=n(62),T=n(103),P=n(97);var S=e=>{let{address:t,product:n,buyProduct:c,deleteProduct:s}=e;const{name:o,image:l,description:d,price:b,sold:p,appId:m,owner:x}=n,[g,h]=Object(a.useState)(1);return Object(i.jsx)(C.a,{children:Object(i.jsxs)(T.a,{className:"h-100",children:[Object(i.jsx)(T.a.Header,{children:Object(i.jsxs)(u.a,{direction:"horizontal",gap:2,children:[Object(i.jsx)("span",{className:"font-monospace text-secondary",children:Object(j.d)(x)}),Object(i.jsx)(O,{size:28,address:x}),Object(i.jsxs)(P.a,{bg:"secondary",className:"ms-auto",children:[p," Sold"]})]})}),Object(i.jsx)("div",{className:"ratio ratio-4x3",children:Object(i.jsx)("img",{src:l,alt:o,style:{objectFit:"cover"}})}),Object(i.jsxs)(T.a.Body,{className:"d-flex flex-column text-center",children:[Object(i.jsx)(T.a.Title,{children:o}),Object(i.jsx)(T.a.Text,{className:"flex-grow-1",children:d}),Object(i.jsxs)(N.a,{className:"d-flex align-content-stretch flex-row gap-2",children:[Object(i.jsx)(A.a,{controlId:"inputCount",label:"Count",className:"w-25",children:Object(i.jsx)(N.a.Control,{type:"number",value:g,min:"1",max:"10",onChange:e=>{h(Number(e.target.value))}})}),Object(i.jsxs)(r.a,{variant:"outline-dark",onClick:()=>c(n,g),className:"w-75 py-3",children:["Buy for ",Object(j.b)(b)*g," ALGO"]}),n.owner===t&&Object(i.jsx)(r.a,{variant:"outline-danger",onClick:()=>s(n),className:"btn",children:Object(i.jsx)("i",{className:"bi bi-trash"})})]})]})]})},m)};var F=()=>Object(i.jsx)("div",{className:"d-flex justify-content-center",children:Object(i.jsx)(b.a,{animation:"border",role:"status",className:"opacity-25",children:Object(i.jsx)("span",{className:"visually-hidden",children:"Loading..."})})});const _=()=>Object(i.jsx)(w.a,{position:"bottom-center",autoClose:5e3,hideProgressBar:!0,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!1,pauseOnHover:!0}),E=e=>{let{text:t}=e;return Object(i.jsxs)("div",{children:[Object(i.jsx)("i",{className:"bi bi-check-circle-fill text-success mx-2"}),Object(i.jsx)("span",{className:"text-secondary mx-1",children:t})]})},k=e=>{let{text:t}=e;return Object(i.jsxs)("div",{children:[Object(i.jsx)("i",{className:"bi bi-x-circle-fill text-danger mx-2"}),Object(i.jsx)("span",{className:"text-secondary mx-1",children:t})]})},D={text:""};E.defaultProps=D,k.defaultProps=D;var B=n(43),L=n(98);var R=e=>{let{address:t,fetchBalance:n}=e;const[c,s]=Object(a.useState)([]),[o,r]=Object(a.useState)(!1),l=async()=>{try{r(!0);const e=await Object(B.d)();if(!e)return;s(e)}catch(e){console.log({e:e})}finally{r(!1)}};Object(a.useEffect)((()=>{l()}),[]);const d=async(e,a)=>{try{r(!0),await Object(B.a)(t,e,a),Object(w.b)(Object(i.jsx)(E,{text:"Product bought successfully"})),l(),n(t)}catch(c){console.log(c),Object(w.b)(Object(i.jsx)(k,{text:"Failed to purchase product."}))}finally{r(!1)}},b=async e=>{try{r(!0),await Object(B.c)(t,e.appId),Object(w.b)(Object(i.jsx)(E,{text:"Product deleted successfully"})),l(),n(t)}catch(a){console.log(a),Object(w.b)(Object(i.jsx)(k,{text:"Failed to delete product."}))}finally{r(!1)}};return o?Object(i.jsx)(F,{}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[Object(i.jsx)("h1",{className:"fs-4 fw-bold mb-0",children:"Street Food"}),Object(i.jsx)(I,{createProduct:async e=>{try{r(!0),await Object(B.b)(t,e),Object(w.b)(Object(i.jsx)(E,{text:"Product added successfully."})),await l(),await n(t)}catch(a){console.log(a),Object(w.b)(Object(i.jsx)(k,{text:(null===a||void 0===a?void 0:a.message)||"Failed to create a product."}))}finally{r(!1)}}})]}),Object(i.jsx)(L.a,{xs:1,sm:2,lg:3,className:"g-3 mb-5 g-xl-4 g-xxl-5",children:Object(i.jsx)(i.Fragment,{children:c.map(((e,n)=>Object(i.jsx)(S,{address:t,product:e,buyProduct:d,deleteProduct:b},n)))})})]})},G=n(7),z=n.p+"static/media/sandwich.2d312449.jpg";var M=function(){const[e,t]=Object(a.useState)(null),[n,c]=Object(a.useState)(null),[s,o]=Object(a.useState)(0),r=async e=>{G.c.lookupAccountByID(e).do().then((e=>{const t=e.account.amount;o(t)})).catch((e=>{console.log(e)}))};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(_,{}),e?Object(i.jsxs)(f.a,{fluid:"md",children:[Object(i.jsx)(y.a,{className:"justify-content-end pt-3 pb-5",children:Object(i.jsx)(y.a.Item,{children:Object(i.jsx)(h,{address:e,name:n,amount:s,disconnect:()=>{t(null),c(null),o(null)},symbol:"ALGO"})})}),Object(i.jsx)("main",{children:Object(i.jsx)(R,{address:e,fetchBalance:r})})]}):Object(i.jsx)(l,{name:"Street Food",coverImg:z,connect:async()=>{G.f.connect().then((e=>{const n=e[0];t(n.address),c(n.name),r(n.address)})).catch((e=>{console.log("Could not connect to MyAlgo wallet"),console.error(e)}))}})]})};var U=e=>{e&&e instanceof Function&&n.e(3).then(n.bind(null,106)).then((t=>{let{getCLS:n,getFID:a,getFCP:c,getLCP:s,getTTFB:o}=t;n(e),a(e),c(e),s(e),o(e)}))};n(89),n(90),n(91);o.a.render(Object(i.jsx)(c.a.StrictMode,{children:Object(i.jsx)(M,{})}),document.getElementById("root")),U()}},[[92,1,2]]]);
//# sourceMappingURL=main.c9b99cbe.chunk.js.map